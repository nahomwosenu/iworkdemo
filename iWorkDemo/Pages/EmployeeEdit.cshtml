@page
@model iWorkDemo.Pages.EmployeeEditModel
@{
    <head><link href="https://fonts.googleapis.com/css?family=Mulish&display=swap" rel="stylesheet" /><link href="./css/main.css" rel="stylesheet" /><title>Document</title>
                                                                                                                                                                                                                <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">
                                                                                                                                                                                                                <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" rel="stylesheet">
                                                                                                                                                                                                                <script src="https://code.jquery.com/jquery-3.6.1.min.js" integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>
                                                                                                                                                                                                                <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.min.js" integrity="sha384-+sLIOodYLS7CIrQpBjl+C7nPvqq+FbNUBDunl/OZv93DB7Ln/533i8e/mZXLi/P+" crossorigin="anonymous"></script>
                                                                                                                                                                                                                <style>
                                                                                                                                                                                                                    img{
                                                                                                                                                                                                                    width: 48px;
                                                                                                                                                                                                                    margin: 5px;
                                                                                                                                                                                                                    }
                                                                                                                                                                                                                    tr{
                                                                                                                                                                                                                    background-color: #fff;
                                                                                                                                                                                                                    align-content: center; 
                                                                                                                                                                                                                    align-items: center;
                                                                                                                                                                                                                    border-color: #FF6B00;
                                                                                                                                                                                                                    border-width: 2px;
                                                                                                                                                                                                                    border-radius: 5px;
                                                                                                                                                                                                                    border-style: solid;
                                                                                                                                                                                                                    border-collapse: separate;
                                                                                                                                                                                                                    margin-top: 10px;
                                                                                                                                                                                                                    }
                                                                                                                                                                                                                    td{
                                                                                                                                                                                                                    height: 50px;
                                                                                                                                                                                                                    text-align: center;
                                                                                                                                                                                                                    vertical-align: middle;
                                                                                                                                                                                                                    }
                                                                                                                                                                                                                    tbody{
                                                                                                                                                                                                                    border-collapse: separate;
                                                                                                                                                                                                                    }
                                                                                                                                                                                                                    i{
                                                                                                                                                                                                                    color: #FF6B00;
                                                                                                                                                                                                                    }
                                                                                                                                                                                                                    table{
                                                                                                                                                                                                                    border-spacing: 10px;
                                                                                                                                                                                                                    margin-top: 20px;
                                                                                                                                                                                                                    }
                                                                                                                                                                                                                </style>
    </head>
    <body style="background-color: #374151;">
                                                                                                                                                                                                                <section >
                                                                                                                                                                                                                              <div class="container py-5">
                                                                                                                                                                                                                                <div class="row">
                                                                                                                                                                                                                                        <div class="col-lg-12 text-white align-items-center justify-content-center">
                                                                                                                                                                                                                                          <h2 style="margin-left: 25%;">Employee's Detail</h2>
                                                                                                                                                                                                                                          <table class="table text-black" style="background-color: #D9D9D9;">
                                                                                                                                                                                                                                            <tbody>
                                                                                                                                                                                                                                              <tr>
                                                                                                                                                                                                                                                <td><img src="images/user.png" alt="avatar" width="48px"> <input type="text" id="firstName" name="firstName" class="form-control form-control-sm" style="max-width: 100px; display: inline-block;" placeholder="First Name"></td>
                                                                                                                                                                                                                                                <td><input type="text" id="lastName" name="lastName" class="form-control form-control-sm" style="max-width: 100px; display: inline-block;" placeholder="Last Name"></td>
                                                                                                                                                                                                                                                <td><input type="text" id="email" name="email" class="form-control form-control-sm" style="max-width: 100px; display: inline-block;" placeholder="Email"></td>
                                                                                                                                                                                                                                                <td><select id="gender" name="gender" class="form-control form-control-sm" style="max-width: 100px; display: inline-block;" >
                                                                                                                                                                                                                                                  <option id="Male">Male</option>
                                                                                                                                                                                                                                                  <option id="Female">Female</option>
                                                                                                                                                                                                                                                </select></td>
                                                                                                                                                                                                                                                <td><button id="update" class="btn btn-primary">Update</button></td>
                                                                                                                                                                                                                                              </tr>
                                                                                                                                                                                                                                            </tbody>
                                                                                                                                                                                                                                          </table>
                                                                                                                                                                                                                                        </div>
                                                                                                                                                                                                                                      </div>
                                                                                                                                                                                                                              </div>
                                                                                                                                                                                                                            </section>
                                                                                                                                                                                                                            <script>
                                                                                                                                                                                                                        let employee = null;
                                                                                                                                                                                                                        $(document).ready(() => {
                                                                                                                                                                                                                            $.ajax({
                                                                                                                                                                                                                                type: "GET",
                                                                                                                                                                                                                                url: "/v1/get",
                                                                                                                                                                                                                                data: {
                                                                                                                                                                                                                                    "id": @{Write(Model.Id);}
                                                                                                                                                                                                                                },
                                                                                                                                                                                                                                success: function(resp) {
                                                                                                                                                                                                                                    if (resp.status == 'success') {
                                                                                                                                                                                                                                        employee = resp.data;
                                                                                                                                                                                                                                        $("#firstName").val(employee.firstName);
                                                                                                                                                                                                                                        $("#lastName").val(employee.lastName);
                                                                                                                                                                                                                                        $("#email").val(employee.email);
                                                                                                                                                                                                                                        $("#gender option[id='"+employee.gender+"']").attr("selected", "selected");
                                                                                                                                                                                                                                    } else {
                                                                                                                                                                                                                                        alert(JSON.stringify(resp.message));
                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                },
                                                                                                                                                                                                                                error: function(err) {
                                                                                                                                                                                                                                    console.log(err);
                                                                                                                                                                                                                                }
                                                                                                                                                                                                                            });

                                                                                                                                                                                                                            $("#update").on("click", function() {
                                                                                                                                                                                                                                let firstName = $("#firstName").val();
                                                                                                                                                                                                                                let lastName = $("#lastName").val();
                                                                                                                                                                                                                                let email = $("#email").val();
                                                                                                                                                                                                                                let gender = $("#gender").find(":selected").text();
                                                                                                                                                                                                                                let updated = false;
                                                                                                                                                                                                                                if (firstName != employee.firstName) {
                                                                                                                                                                                                                                    employee.firstName = firstName;
                                                                                                                                                                                                                                    updated = true;
                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                if (lastName != employee.lastName) {
                                                                                                                                                                                                                                    employee.lastName = lastName;
                                                                                                                                                                                                                                    updated = true;
                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                if (email != employee.email) {
                                                                                                                                                                                                                                    employee.email = email;
                                                                                                                                                                                                                                    updated = true;
                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                if (gender != employee.gender) {
                                                                                                                                                                                                                                    employee.gender = gender;
                                                                                                                                                                                                                                    updated = true;
                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                if (!updated) {
                                                                                                                                                                                                                                    alert('No changes were made');
                                                                                                                                                                                                                                } else {
                                                                                                                                                                                                                                    var fd = new FormData();
                                                                                                                                                                                                                                    fd.append("id", employee.id);
                                                                                                                                                                                                                                    fd.append("firstName", employee.firstName);
                                                                                                                                                                                                                                    fd.append("lastName", employee.lastName);
                                                                                                                                                                                                                                    fd.append("email", employee.email);
                                                                                                                                                                                                                                    fd.append("gender", employee.gender);

                                                                                                                                                                                                                                    $.ajax({
                                                                                                                                                                                                                                        type: "POST",
                                                                                                                                                                                                                                        url: "/v1/update",
                                                                                                                                                                                                                                        data: fd,
                                                                                                                                                                                                                                        processData: false,
                                                                                                                                                                                                                                        contentType: false,
                                                                                                                                                                                                                                        success: function(resp) {
                                                                                                                                                                                                                                            if (resp.status == 'success') {
                                                                                                                                                                                                                                                alert('Record updated successfuly');
                                                                                                                                                                                                                                            } else {
                                                                                                                                                                                                                                                alert('Something went wrong!');
                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                        },
                                                                                                                                                                                                                                        error: function(err) {
                                                                                                                                                                                                                                            console.log(err);
                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                    })
                                                                                                                                                                                                                                }
                                                                                                                                                                                                                            });
                                                                                                                                                                                                                        });
                                                                                                                                                                                                                            </script>
    </body>
}
